<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Verlet Driving Simulator</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;800&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app-layout">

    <!-- ==================== GAUGES ==================== -->
    <div class="gauge-row">
      <div class="gauge-frame">
        <div class="gauge-inner">
          <canvas id="latGCanvas" width="900" height="780" class="gauge-canvas"></canvas>
          <div class="badge"><b>LAT G</b> g-force</div>
        </div>
      </div>
      <div class="gauge-frame">
        <div class="gauge-inner">
          <canvas id="speedCanvas" width="900" height="780" class="gauge-canvas"></canvas>
          <div class="badge"><b>SPEED</b> km/h</div>
        </div>
      </div>
      <div class="gauge-frame">
        <div class="gauge-inner">
          <canvas id="rpmCanvas" width="900" height="780" class="gauge-canvas"></canvas>
          <div class="badge"><b>ENGINE</b> RPM</div>
        </div>
      </div>
    </div>

    <!-- ==================== SIMULATION ==================== -->
    <div class="canvas-wrapper">
      <div class="canvas-resolution-control">
        <span>Canvas Res</span>
        <input type="range" id="canvasResolutionSlider" min="0.5" max="2.0" value="1.0" step="0.1">
        <span class="canvas-resolution-value" id="canvasResolutionValue">1.0</span>
      </div>
      <canvas id="simCanvas" width="1600" height="1200"></canvas>
      <div class="info-bar">
        <div class="info-cell">
          <div class="label">Speed</div>
          <div class="value" id="velocityDisplay">0.0 km/h</div>
        </div>
        <div class="info-cell">
          <div class="label">RPM</div>
          <div class="value" id="rpmDisplay">800</div>
        </div>
        <div class="info-cell">
          <div class="label">Gear</div>
          <div class="value" id="gearDisplay">N</div>
        </div>
        <div class="info-cell">
          <div class="label">Heading</div>
          <div class="value" id="headingDisplay">0¬∞</div>
        </div>
        <div class="info-cell">
          <div class="label">Clutch</div>
          <div class="value" id="clutchDisplay">100%</div>
        </div>
        <div class="info-cell">
          <div class="label">Trail</div>
          <div class="value" id="trailDisplay">0 arrows</div>
        </div>
      </div>
    </div>

    <!-- ==================== CONTROLS ==================== -->
    <div class="control-grid">

      <!-- Simulation Panel -->
      <div class="panel-section">
        <h3>‚ö° Simulation</h3>
        <div class="slider-row">
          <span class="slider-label">Sim FPS</span>
          <!-- Snapped to nearest 10Hz in ui.js; range 10‚Äì120 -->
          <input type="range" id="simulationFps" min="10" max="120" value="60" step="10">
          <span class="slider-value" id="simulationFpsValue">60</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Time Scale</span>
          <input type="range" id="timeScale" min="0.1" max="3.0" value="1.0" step="0.1">
          <span class="slider-value" id="timeScaleValue">1.00</span>
        </div>
      </div>

      <!-- Car Physics Panel -->
      <div class="panel-section">
        <h3>üèéÔ∏è Car Physics</h3>
        <div class="slider-row">
          <span class="slider-label">Mass (kg)</span>
          <input type="range" id="carMassKg" min="600" max="3000" value="1200" step="50">
          <span class="slider-value" id="carMassKgValue">1200</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Roll Resist.</span>
          <!-- Rolling resistance coefficient (SI): F = coeff √ó mass √ó g; typical 0.010‚Äì0.020 -->
          <input type="range" id="rollingResistanceCoeff" min="0.001" max="0.03" value="0.012" step="0.001">
          <span class="slider-value" id="rollingResistanceCoeffValue">0.012</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Aero Drag</span>
          <!-- Aero drag coefficient (N¬∑s¬≤/m¬≤): F = k √ó speed¬≤; 0.5√óœÅ√óCd√óA ‚âà 0.4 -->
          <input type="range" id="aeroDragCoeff" min="0.1" max="1.0" value="0.4" step="0.01">
          <span class="slider-value" id="aeroDragCoeffValue">0.40</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Tire Friction</span>
          <input type="range" id="tireFrictionCoeff" min="0.3" max="2.0" value="1.0" step="0.05">
          <span class="slider-value" id="tireFrictionCoeffValue">1.00</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">CoG Height (m)</span>
          <!-- Height of centre of gravity in metres; higher = more weight transfer -->
          <input type="range" id="cogHeight" min="0.1" max="2.0" value="0.5" step="0.05">
          <span class="slider-value" id="cogHeightValue">0.50</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Bounciness</span>
          <input type="range" id="bounciness" min="0.0" max="1.0" value="0.3" step="0.05">
          <span class="slider-value" id="bouncinessValue">0.30</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Stall Resist.</span>
          <!-- How hard the engine fights stalling when RPM drops in the slip zone -->
          <input type="range" id="stallResistance" min="0.0" max="1.0" value="0.5" step="0.05">
          <span class="slider-value" id="stallResistanceValue">0.50</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Yaw Damping</span>
          <!-- Decay rate (1/s): 0=undamped spin, 1=realistic, 3=stability, 5=heavy assist -->
          <input type="range" id="yawDamping" min="0.0" max="5.0" value="1.0" step="0.1">
          <span class="slider-value" id="yawDampingValue">1.0</span>
        </div>
        <button id="engineToggle" style="width:100%;padding:8px;margin-top:10px;font-family:'JetBrains Mono',monospace;font-size:0.8rem;font-weight:700;letter-spacing:1px;background:#2ecc71;color:#111;border:2px solid #2ecc71;border-radius:8px;cursor:pointer">Engine ON</button>
      </div>

      <!-- Clutch Panel -->
      <div class="panel-section">
        <h3>‚öôÔ∏è Clutch</h3>
        <div class="slider-row">
          <span class="slider-label">Bite Point</span>
          <!-- Pedal position (0=floor) where clutch begins to engage -->
          <input type="range" id="clutchBitePoint" min="0.05" max="0.85" value="0.35" step="0.01">
          <span class="slider-value" id="clutchBitePointValue">0.35</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Slip Zone</span>
          <!-- Width of the partial-engagement zone above bite point -->
          <input type="range" id="clutchBiteRange" min="0.02" max="0.5" value="0.20" step="0.01">
          <span class="slider-value" id="clutchBiteRangeValue">0.20</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Bite Sharpness</span>
          <!-- Exponent: 1.0=linear, >1=bites sharply near top of slip zone -->
          <input type="range" id="clutchBiteCurve" min="1.0" max="6.0" value="2.5" step="0.1">
          <span class="slider-value" id="clutchBiteCurveValue">2.5</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Engage Time (s)</span>
          <!-- Time in seconds for pedal to travel full range -->
          <input type="range" id="clutchEngageTime" min="0.05" max="1.5" value="0.30" step="0.01">
          <span class="slider-value" id="clutchEngageTimeValue">0.30</span>
        </div>
      </div>

      <!-- Trail Panel -->
      <div class="panel-section">
        <h3>üéØ Velocity Trail</h3>
        <div class="slider-row">
          <span class="slider-label">Spawn (s)</span>
          <!-- Logarithmic: slider 0‚Äì100 maps to 0.001s‚Äì10s -->
          <input type="range" id="trailSpawnInterval" min="0" max="100" value="35" step="1">
          <span class="slider-value" id="trailSpawnIntervalValue">0.080s</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Lifespan (s)</span>
          <input type="range" id="trailLifespan" min="0.5" max="10.0" value="3.0" step="0.1">
          <span class="slider-value" id="trailLifespanValue">3.0</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Fade</span>
          <!-- Fade exponent: 1.0=linear fade, 2.0=quadratic, etc. -->
          <input type="range" id="trailFade" min="0.2" max="3.0" value="1.0" step="0.05">
          <span class="slider-value" id="trailFadeValue">1.00</span>
        </div>
      </div>

      <!-- Camera Panel -->
      <div class="panel-section">
        <h3>üì∑ Camera</h3>
        <div class="slider-row">
          <span class="slider-label">Stiffness</span>
          <input type="range" id="cameraStiffness" min="0.5" max="20.0" value="5.0" step="0.5">
          <span class="slider-value" id="cameraStiffnessValue">5.0</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Damping</span>
          <input type="range" id="cameraDamping" min="1.0" max="20.0" value="6.0" step="0.5">
          <span class="slider-value" id="cameraDampingValue">6.0</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Zoom Sens</span>
          <input type="range" id="cameraZoomSensitivity" min="0.0" max="1.0" value="0.3" step="0.05">
          <span class="slider-value" id="cameraZoomSensitivityValue">0.30</span>
        </div>
      </div>

      <!-- Motion Blur Panel -->
      <div class="panel-section">
        <h3>üí® Motion Blur</h3>
        <div class="slider-row">
          <span class="slider-label">Samples</span>
          <input type="range" id="motionBlurSamples" min="1" max="16" value="6" step="1">
          <span class="slider-value" id="motionBlurSamplesValue">6</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Intensity</span>
          <input type="range" id="motionBlurIntensity" min="0.0" max="2.0" value="0.6" step="0.1">
          <span class="slider-value" id="motionBlurIntensityValue">0.60</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Threshold (m/s)</span>
          <!-- Speed above which blur activates; 10 m/s ‚âà 36 km/h -->
          <input type="range" id="motionBlurThreshold" min="1" max="50" value="10" step="1">
          <span class="slider-value" id="motionBlurThresholdValue">10</span>
        </div>
      </div>

      <!-- Map Size Panel -->
      <div class="panel-section">
        <h3>üó∫Ô∏è Map Size</h3>
        <div class="slider-row">
          <span class="slider-label">Width (m)</span>
          <input type="range" id="mapWidth" min="100" max="1000" value="300" step="10">
          <span class="slider-value" id="mapWidthValue">300</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Height (m)</span>
          <input type="range" id="mapHeight" min="100" max="1000" value="240" step="10">
          <span class="slider-value" id="mapHeightValue">240</span>
        </div>
      </div>

      <!-- Gauges Panel -->
      <div class="panel-section">
        <h3>üéöÔ∏è Gauges</h3>
        <div class="slider-row">
          <span class="slider-label">Label Scale</span>
          <!-- Slider 60‚Äì160 ‚Üí scale 0.6√ó‚Äì1.6√ó in ui.js -->
          <input type="range" id="gaugeLabelScale" min="60" max="160" value="100" step="5">
          <span class="slider-value" id="gaugeLabelScaleValue">1.0√ó</span>
        </div>
      </div>

      <!-- Engine & Drivetrain Panel -->
      <div class="panel-section">
        <h3>üîß Engine &amp; Drivetrain</h3>
        <div class="slider-row">
          <span class="slider-label">Peak Torque (Nm)</span>
          <input type="range" id="peakEngineTorqueNm" min="100" max="5000" value="2800" step="50">
          <span class="slider-value" id="peakEngineTorqueNmValue">2800</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Idle RPM</span>
          <input type="range" id="idleRpm" min="400" max="1500" value="800" step="50">
          <span class="slider-value" id="idleRpmValue">800</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Redline RPM</span>
          <input type="range" id="redlineRpm" min="4000" max="10000" value="7000" step="100">
          <span class="slider-value" id="redlineRpmValue">7000</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Stall RPM</span>
          <input type="range" id="stallRpm" min="100" max="1000" value="600" step="50">
          <span class="slider-value" id="stallRpmValue">600</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Wheel Radius (m)</span>
          <input type="range" id="wheelRadius" min="0.2" max="0.6" value="0.35" step="0.01">
          <span class="slider-value" id="wheelRadiusValue">0.35</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Final Drive</span>
          <input type="range" id="finalDriveRatio" min="1.0" max="8.0" value="4.1" step="0.1">
          <span class="slider-value" id="finalDriveRatioValue">4.1</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Brake Force (N)</span>
          <input type="range" id="brakeForce" min="500" max="20000" value="9810" step="100">
          <span class="slider-value" id="brakeForceValue">9810</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Idle Creep (N)</span>
          <input type="range" id="idleCreepForce" min="0" max="500" value="200" step="10">
          <span class="slider-value" id="idleCreepForceValue">200</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Gear 1</span>
          <input type="range" id="gearRatio1" min="0.5" max="6.0" value="3.5" step="0.05">
          <span class="slider-value" id="gearRatio1Value">3.50</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Gear 2</span>
          <input type="range" id="gearRatio2" min="0.5" max="5.0" value="2.1" step="0.05">
          <span class="slider-value" id="gearRatio2Value">2.10</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Gear 3</span>
          <input type="range" id="gearRatio3" min="0.3" max="3.0" value="1.4" step="0.05">
          <span class="slider-value" id="gearRatio3Value">1.40</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Gear 4</span>
          <input type="range" id="gearRatio4" min="0.2" max="2.0" value="1.0" step="0.05">
          <span class="slider-value" id="gearRatio4Value">1.00</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Gear 5</span>
          <input type="range" id="gearRatio5" min="0.1" max="1.5" value="0.75" step="0.05">
          <span class="slider-value" id="gearRatio5Value">0.75</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Gear 6</span>
          <input type="range" id="gearRatio6" min="0.1" max="1.2" value="0.58" step="0.05">
          <span class="slider-value" id="gearRatio6Value">0.58</span>
        </div>
      </div>

      <!-- Tire Model Panel -->
      <div class="panel-section">
        <h3>üèéÔ∏è Tire Model (Pacejka)</h3>
        <div class="slider-row">
          <span class="slider-label">Pacejka B</span>
          <!-- Stiffness factor: higher = sharper grip peak, more sudden breakaway -->
          <input type="range" id="pacejkaB" min="1" max="30" value="10" step="0.5">
          <span class="slider-value" id="pacejkaBValue">10.0</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Pacejka C</span>
          <!-- Shape factor: controls how wide the force curve is -->
          <input type="range" id="pacejkaC" min="0.5" max="3.0" value="1.9" step="0.05">
          <span class="slider-value" id="pacejkaCValue">1.90</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Peak Slip Angle (¬∞)</span>
          <!-- Slip angle at peak lateral force; typical 6‚Äì10¬∞ -->
          <input type="range" id="peakSlipAngleDeg" min="2" max="20" value="8" step="0.5">
          <span class="slider-value" id="peakSlipAngleDegValue">8.0</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Peak Slip Ratio</span>
          <!-- Longitudinal slip ratio at peak traction; typical 0.1‚Äì0.15 -->
          <input type="range" id="peakSlipRatio" min="0.05" max="0.30" value="0.12" step="0.01">
          <span class="slider-value" id="peakSlipRatioValue">0.12</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Max Steer Angle (rad)</span>
          <!-- Maximum physical tyre lock angle; 0.52 rad ‚âà 30¬∞ -->
          <input type="range" id="maxFrontWheelAngle" min="0.1" max="1.0" value="0.52" step="0.01">
          <span class="slider-value" id="maxFrontWheelAngleValue">0.52</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Steer Drag Range (px)</span>
          <!-- Mouse drag pixels for full lock; larger = lighter steering -->
          <input type="range" id="steeringDragRange" min="50" max="400" value="150" step="10">
          <span class="slider-value" id="steeringDragRangeValue">150</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Self-Center Rate</span>
          <!-- Rate at which steering wheel returns to centre when released -->
          <input type="range" id="steeringSelfCenterRate" min="0" max="20" value="5.0" step="0.5">
          <span class="slider-value" id="steeringSelfCenterRateValue">5.0</span>
        </div>
      </div>

      <!-- World & Visual Panel -->
      <div class="panel-section">
        <h3>üåç World &amp; Visual</h3>
        <div class="slider-row">
          <span class="slider-label">Constraint Iters</span>
          <!-- Jakobsen solver passes per step; more = stiffer body, slower -->
          <input type="range" id="constraintIterations" min="1" max="12" value="6" step="1">
          <span class="slider-value" id="constraintIterationsValue">6</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Checker Tile (px)</span>
          <!-- Visual size of each checkerboard square in screen pixels at zoom=1 -->
          <input type="range" id="checkerboardTileSize" min="20" max="200" value="80" step="5">
          <span class="slider-value" id="checkerboardTileSizeValue">80</span>
        </div>
        <div class="slider-row">
          <span class="slider-label">Max Trail Arrows</span>
          <!-- Hard cap on total alive arrows; higher = more history, more CPU -->
          <input type="range" id="maxTrailArrows" min="50" max="1200" value="600" step="50">
          <span class="slider-value" id="maxTrailArrowsValue">600</span>
        </div>
      </div>

    </div>

    <!-- ==================== KEY HINTS ==================== -->
    <div class="keys-hint">
      <span><kbd>üñ±Ô∏è R-Drag</kbd> steer</span>
      <span><kbd>üñ±Ô∏è L-Drag‚Üë‚Üì</kbd> throttle</span>
      <span><kbd>D</kbd> full throttle</span>
      <span><kbd>S</kbd> brake</span>
      <span><kbd>A</kbd> clutch pedal (hold=floor, release=engage)</span>
      <span><kbd>Numpad 7/1/8/2/9/3</kbd> gears 1‚Äì6</span>
      <span><kbd>Numpad 4/5/6</kbd> neutral</span>
      <span><kbd>Q+Numpad1</kbd> reverse</span>
    </div>

  </div>

  <!-- Entry point ‚Äî ES module -->
  <script type="module" src="js/main.js"></script>
</body>
</html>
